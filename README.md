# mlo-ai-builder

Beginner-friendly PowerShell workflow that turns a natural-language description into a FiveM-ready MLO blockout using Blender 4.5 LTS running headless with Python scripting. It leans on the open-source Sollumz Blender add-on (supports GTA V formats including YDR/YBN/YTYP and partial YMAP via XML) and respects CodeWalker-driven XML imports.

> Deterministic templates instead of cloud LLMs. You always get a generated floorplan you can inspect and edit offline.

## How to Run (3 commands)
1. **Doctor check** – confirms Blender/Sollumz visibility and write permissions:
   ```powershell
   .\mlo.ps1 -Doctor -Out .\builds\station51
   ```
2. **Build + headless export** – produces `floorplan.json`, `PLAN.md`, `blockout.blend`, and XML/binary exports if possible:
   ```powershell
   .\mlo.ps1 -Prompt "Two-bay firehouse with dorms and watch office" -Out .\builds\station51 -Place "Sandy Shores" -Floors 2
   ```
3. **Final export (if binaries missing)** – opens Blender UI with guidance to compile YDR/YBN/YTYP:
   ```powershell
   .\mlo.ps1 -FinalExport -Out .\builds\station51
   ```

Each run appends `run_log.txt` in your `-Out` folder. Success/fallback banners print the exact paths to `blockout.blend` and the `stream` folder.

## CLI Overview
- `-Prompt` (required for builds): natural-language description.
- `-Out` (required): output folder (blend, JSON, resource).
- `-Place`: placement hint for CodeWalker helper docs.
- `-Floors`: number of floors (default 1).
- `-SkipBlender`: reuse an existing blend without rebuilding.
- `-SkipPackage`: skip FiveM packaging.
- `-FinalExport`: launch Blender UI with guided export helper.
- `-Doctor`: run environment checks.
- `-BlenderPath`: override Blender path detection.

## Pipeline
1. **Prompt parser** (`src/prompt_to_floorplan.py`): converts the prompt to `floorplan.json` and `PLAN.md` using building-type templates (fire station, police station, hospital, nightclub, warehouse, generic office). Defaults include 0.2 m wall thickness, ~3.2 m floor heights, and hallway widths tuned per template. Fire station plans create two 18m x 14m bays with sensible support spaces and a single stair core.
2. **Blender blockout** (`src/blender/build_from_floorplan.py`): executed via `blender -b -P ... -- --floorplan ... --output ... --blend ...` to build grid-aligned rectangular rooms, walls, ceilings, corridors, stairs, and an origin helper object. Collections: GEO, COLLISION, HELPERS. Objects prefixed `ROOM_`, `WALL_`, `CEIL_`, `STAIR_`, `DOORCUT_`, `BAYOPEN_*` where applicable. Transforms are applied for uniform scale and floors stack using the configured floor height.
3. **Sollumz export** (`src/blender/export_sollumz.py`): discovers operators dynamically (no hardcoded IDs). Headless mode always produces at least an XML placeholder in `fivem_resource/<name>/stream` and prints discovered operators. If binaries are missing, it prints the exact `-FinalExport` command to run.
4. **Final Export UI helper** (`src/blender/final_export_ui.py`): runs inside Blender UI to select GEO meshes, ensure Sollumz materials, convert to Drawable, attempt `export_assets`, and write `export_log.txt`. If automation fails, it prints a 6-step click guide with the stream path.
5. **FiveM packager** (`src/fivem/package_resource.py`): creates `fxmanifest.lua`, README, placement helper, and copies `floorplan.json` plus any headless exports into `fivem_resource/<resource>/stream`.

## Placement Helper (CodeWalker)
Headless CodeWalker automation is **not assumed**. The generated `PLACEMENT.md` provides a guided checklist:
1. Open CodeWalker, load the map.
2. Import XML generated by CodeWalker (Sollumz expects CodeWalker XMLs for round-tripping).
3. Create/position a YMAP for the MLO using suggested coordinates/rotation.
4. Save the YMAP and export XML to keep future Blender imports consistent.

## Performance and MLO Basics
- Keep walls/floors simple for early blockouts; add LODs and collision meshes as you polish.
- Use SOLLUMZ collision exports for COL meshes and keep portals/rooms organized if you extend into full MLO authoring.
- Maintain sensible hallway widths (2.2–3.0 m), door widths (1.0 m single, 1.8 m double, 3.5–4.5 m bay), and floor heights (~3.2 m by default).
- Place helper origin at 0,0,0 to align with FiveM placement.

## Troubleshooting
- **No Sollumz operators found**: ensure the add-on is installed and enabled in Blender. Re-run `.\mlo.ps1` or open the `.blend` and export manually following the printed steps or `final_export_ui.py` guide.
- **Blender missing**: add `blender.exe` to PATH or use `-BlenderPath`.
- **Prompt looks wrong**: edit the generated `PLAN.md` or `floorplan.json` and re-run with `-SkipBlender` to skip regeneration.
- **XML only**: use `-FinalExport` to produce binaries; the stream path is printed at the end of the headless run.

## Examples
- `examples/station51_firehouse.txt`
- `examples/nightclub.txt`
- `examples/sandy_shores_motel.txt`

## Notes on Capabilities
- Blender supports headless execution with Python scripting for automation.
- Sollumz is a Blender add-on for GTA V assets supporting YDR/YBN/YTYP and partial YMAP via XML, and its import workflow relies on XML exported from CodeWalker.
- Full CodeWalker placement automation is not guaranteed; default to the provided checklist unless you provide a working API.
